---
title: "Exploratory Data Analysis"
author: "Taylor Bonar, Alexandre Jasserme & Halle Purdom"
date: "5/26/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Libraries to load
library(plyr)
library(ggplot2)
library(tidyverse)
library(GGally)

# Set current working directory as git repository local folder
setwd(".")

# Retrieve current dataset
life_expectancy = read.csv("Life Expectancy Data.csv", header = TRUE)
```

```{r}
life_expectancy <- life_expectancy %>%  rename('LifeExpectancy'='Life.expectancy',
                                               'AdultMortality'='Adult.Mortality',
                                               'InfantDeaths'='infant.deaths',
                                               'PercentageExpenditure'='percentage.expenditure',
                                               'HepatitisB'='Hepatitis.B',
                                               'UnderFiveDeaths'='under.five.deaths',
                                               'TotalExpenditure'='Total.expenditure',
                                               'HIV_AIDS'='HIV.AIDS',
                                               'Thinness_1_19_years' = 'thinness..1.19.years',
                                               'Thinness_5_9_years' = 'thinness.5.9.years',
                                               'IncomeCompositionOfResources' = 'Income.composition.of.resources')

summary(life_expectancy)
```

# Comments on each column
Description taken from one of the following:
- https://www.kaggle.com/kumarajarshi/life-expectancy-who: Data Explorer -> Column
- https://www.who.int/data/gho/data/indicators/indicators-index (and will be marked from )

## Country
```{r Country as Factor}
# Check for unique countries to match expectation and transform into factor class for later analysis, should be 193 countries
count(life_expectancy, vars='Country')
# Transform into factor for easier analysis
life_expectancy[,'Country'] <- factor(life_expectancy[,'Country'])
```

## Year
```{r Year as Factor}
# Transform Years into factor
life_expectancy[,'Year'] <- factor(life_expectancy[,'Year'])
```

## Status
Some of the data in this column has been changed:
- It's not clear what is the cutline between a Developed and a Developing country
- In the original data, the following countries were marked as Developed: Hungary, Italy, Latvia, Lithuania, Poland, Spain, Portugal
- Based on this and the GDP per capita (from https://api.worldbank.org/v2/en/indicator/NY.GDP.PCAP.PP.CD?downloadformat=csv, using data from 2015), the Status for the following countries will be changed from Developing to Developed: Bahamas, Bahrain, Canada, Finland, France, Greece, Israel, Monaco, Qatar, Republic of Korea, San Marino, Saudi Arabia, United Arab Emirates

```{r}
print(paste0("Before change: number of rows with Developed: ", sum(life_expectancy$Status == "Developed")))
print(paste0("Before change: number of rows with Developing: ", sum(life_expectancy$Status == "Developing")))
life_expectancy$Status <- ifelse(life_expectancy$Country %in% c('Bahamas', 'Bahrain', 'Canada', 'Finland', 'France', 'Greece', 'Israel', 'Monaco', 'Qatar', 'Republic of Korea', 'San Marino', 'Saudi Arabia', 'United Arab Emirates'), "Developed", life_expectancy$Status)
print(paste0("After change: number of rows with Developed: ", sum(life_expectancy$Status == "Developed")))
print(paste0("After change: number of rows with Developing: ", sum(life_expectancy$Status == "Developing")))

life_expectancy[,'Status'] <- factor(life_expectancy[,'Status'])
```
After the change, the number of rows with Developed increased by 690-512=178 (with a corresponding decrease for the rows with Developing), which makes sense because the Status was updated for 13 countries and we have 16 rows for most countries (for years 2000 to 2015) but we only have 1 row for Monaco and San Marino (both for year 2013): 11*16 + 2*1 = 178

## Life expectancy
Description (from WHO): This seems to be "Life expectancy at birth (years)" (the other option "Life expectancy at age 60 (years)" is not consistent with the data)

## Adult Mortality
Description: Adult Mortality Rates of both sexes (probability of dying between 15 and 60 years per 1000 population)

## infant deaths
Description: Number of Infant Deaths per 1000 population
The maximum of 1800.0 seems to be inaccurate

## Alcohol
Description: Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)
200 N/A (out of almost 3,000 observations)

## percentage expenditure
Description: Expenditure on health as a percentage of Gross Domestic Product per capita(%)
A lot of problem in this column, for example:
- Min.: 0.000  
- Max.: 19479.912

## Hepatitis B
Description: Hepatitis B (HepB) immunization coverage among 1-year-olds (%)
500 N/A (out of almost 3,000 observations)

## Measles
Measles - number of reported cases per 1000 population
A lot of problem in this column, for example:
- Max.: 212183.0

## BMI
A lot of problem in this column, for example:
- Min.: 1.00
- Max.: 87.30

## under-five deaths
Not sure if it's a rate for 1000 population, WHO site not clear.

## Polio	
Description (from WHO): It's probably referring to "immunization coverage among one-year-olds (%)"

## Total expenditure
Description (from WHO): Total expenditure on health as a percentage of gross domestic product
200 N/A (out of almost 3,000 observations)

## Diphtheria
Description (from WHO): Diphtheria tetanus toxoid and pertussis (DTP3) immunization coverage among 1-year-olds (%)

## HIV/AIDS
Description: there are 23 indicators related to HIV on the WHO web site, I'm not sure which one it is

## GDP
Countries' corresponding economic data was collected from United Nation website
400 N/A (out of almost 3,000 observations)
```{r GDP Data Cleanup}
# What rows are missing GDP?
missing_GDP_indices <- which(is.na(life_expectancy[,'GDP']))
count(duplicated(life_expectancy[missing_GDP_indices, 'Year']))

# Are any specific year a key indicator of missing value?
count(life_expectancy[missing_GDP_indices,], 'Year')
# 2000-2015 are missing are about even for missing data except 2013 has more

# What about country?
count(life_expectancy[missing_GDP_indices,], 'Country')

# Year and Country Missing Entries
count(life_expectancy[missing_GDP_indices,], c('Country','Year'))

# Fill missing GDP data from secondary source

```

## Population
700 N/A (out of almost 3,000 observations)
Min is probably wrong (population of 34?)

## thinness  1-19 years
Description (from WHO): this could be Prevalence of thinness among children and adolescents, BMI < -2 standard deviations below the median (crude estimate) (%)

## thinness 5-9 years
Description: this could be a subset of the category above

## Income composition of resources	
The Human Development Index is a statistic composite index of life expectancy, education, and per capita income indicators, which are used to rank countries into four tiers of human development.

## Schooling
Not sure what this is (average number of years of school attended?) but may not be consistent with min and max
