---
title: "Exploratory Data Analysis"
author: "Taylor Bonar, Alexandre Jasserme & Halle Purdom"
date: "5/26/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Function to investigate missing values in a column
investigate_missing_column_values <- function(column_name) {
  missing_indices <- which(is.na(life_expectancy[,column_name]))
  print(length(missing_indices))

  # Are any specific year a key indicator of missing value?
  print(life_expectancy[missing_indices,] %>% 
    group_by(Year) %>%
    summarise(missing = length(Year)))

  # What about country?
  print(life_expectancy[missing_indices,] %>% 
  group_by(Country) %>%
  summarise(missing = length(Country)))

}

# Function to investigate over 1,000 values (for infant deaths and under 5 deaths)
investigate_over1000 <- function(column_name) {
  indices1000 <- which(life_expectancy[,column_name]>1000)
  print(length(indices1000))

  # Are any specific year a key indicator of missing value?
  print(life_expectancy[indices1000,] %>% 
    group_by(Year) %>%
    summarise(missing = length(Year)))

  # What about country?
  print(life_expectancy[indices1000,] %>% 
  group_by(Country) %>%
  summarise(missing = length(Country)))

}


# Libraries to load
library(plyr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(GGally)

# Set current working directory as git repository local folder
setwd(".")

# Retrieve current dataset
life_expectancy = read.csv("Life Expectancy Data.csv", header = TRUE, fileEncoding = "UTF-8")
```

```{r}
life_expectancy <- life_expectancy %>%  rename('LifeExpectancy'='Life.expectancy',
                                               'AdultMortality'='Adult.Mortality',
                                               'InfantDeaths'='infant.deaths',
                                               'PercentageExpenditure'='percentage.expenditure',
                                               'HepatitisB'='Hepatitis.B',
                                               'UnderFiveDeaths'='under.five.deaths',
                                               'TotalExpenditure'='Total.expenditure',
                                               'HIV_AIDS'='HIV.AIDS',
                                               'Thinness_1_19_years' = 'thinness..1.19.years',
                                               'Thinness_5_9_years' = 'thinness.5.9.years',
                                               'IncomeCompositionOfResources' = 'Income.composition.of.resources')

summary(life_expectancy)
```

# Comments on each column
Description taken from one of the following:
- https://www.kaggle.com/kumarajarshi/life-expectancy-who: Data Explorer -> Column
- https://www.who.int/data/gho/data/indicators/indicators-index (and will be marked from )

## Country - need to discuss if we should even consider it as a candidate for the model or not?
```{r Country as Factor}
# Check for unique countries to match expectation and transform into factor class for later analysis, should be 193 countries
life_expectancy %>% 
  group_by(Country) %>%
  summarise(count = length(Country))
# Check for any countries that do not have 16 rows/year of data (hint hint Tuvalu, and some others)

# What year do they have?


# Transform into factor for easier analysis
life_expectancy[,'Country'] <- factor(life_expectancy[,'Country'])
unique(life_expectancy[,"Country"])
```

## Year - need to discuss if we should restrict to 2000 to 2014 (instead of 2015) because of missing data in 2015
```{r Year as Factor}
# Transform Years into factor
life_expectancy[,'Year'] <- factor(life_expectancy[,'Year'])
unique(life_expectancy[,"Year"])
```

## Status
Some of the data in this column has been changed:
- It's not clear what is the cutline between a Developed and a Developing country
- In the original data, the following countries were marked as Developed: Hungary, Italy, Latvia, Lithuania, Poland, Spain, Portugal
- Based on this and the GDP per capita (from https://api.worldbank.org/v2/en/indicator/NY.GDP.PCAP.PP.CD?downloadformat=csv, using data from 2015), the Status for the following countries will be changed from Developing to Developed: Bahamas, Bahrain, Canada, Finland, France, Greece, Israel, Monaco, Qatar, Republic of Korea, San Marino, Saudi Arabia, United Arab Emirates

```{r}
print(paste0("Before change: number of rows with Developed: ", sum(life_expectancy$Status == "Developed")))
print(paste0("Before change: number of rows with Developing: ", sum(life_expectancy$Status == "Developing")))
life_expectancy$Status <- ifelse(life_expectancy$Country %in% c('Bahamas', 'Bahrain', 'Canada', 'Finland', 'France', 'Greece', 'Israel', 'Monaco', 'Qatar', 'Republic of Korea', 'San Marino', 'Saudi Arabia', 'United Arab Emirates'), "Developed", life_expectancy$Status)
print(paste0("After change: number of rows with Developed: ", sum(life_expectancy$Status == "Developed")))
print(paste0("After change: number of rows with Developing: ", sum(life_expectancy$Status == "Developing")))

life_expectancy[,'Status'] <- factor(life_expectancy[,'Status'])
```
After the change, the number of rows with Developed increased by 690-512=178 (with a corresponding decrease for the rows with Developing), which makes sense because the Status was updated for 13 countries and we have 16 rows for most countries (for years 2000 to 2015) but we only have 1 row for Monaco and San Marino (both for year 2013): 11*16 + 2*1 = 178

## Life expectancy
Description (from WHO): This seems to be "Life expectancy at birth (years)" (the other option "Life expectancy at age 60 (years)" is not consistent with the data)
```{r}
investigate_missing_column_values("LifeExpectancy")
```


## Adult Mortality
Description: Adult Mortality Rates of both sexes (probability of dying between 15 and 60 years per 1000 population)
```{r}
investigate_missing_column_values("AdultMortality")
```


## infant deaths
Description: Number of Infant Deaths per 1000 population
The maximum of 1800.0 seems to be inaccurate
```{r}
summary(life_expectancy$InfantDeaths)
life_expectancy %>% ggplot(aes(x=life_expectancy$InfantDeaths))+geom_histogram()

investigate_over1000("InfantDeaths")
```


## Alcohol
Description: Alcohol, recorded per capita (15+) consumption (in liters of pure alcohol)
The data seems to make sense (reasonable min and max, low consumption in mainly Muslim countries, for example)
200 N/A (out of almost 3,000 observations) - most of the missing data is from the most recent year (2015). One country, South Sudan, doesn't have any data for all the years

```{r}
investigate_missing_column_values("Alcohol")
```

## percentage expenditure
Description: Expenditure on health as a percentage of Gross Domestic Product per capita(%)
A lot of problem in this column, for example:
- Min.: 0.000  
- Max.: 19479.912

## Hepatitis B
Description: Hepatitis B (HepB) immunization coverage among 1-year-olds (%)
500 N/A (out of almost 3,000 observations)

## Measles
Measles - number of reported cases per 1000 population
A lot of problem in this column, for example:
- Max.: 212183.0

## BMI
A lot of problem in this column, for example:
- Min.: 1.00
- Max.: 87.30

Only small number of missing values so main issue is accuracy of the data

```{r}
investigate_missing_column_values("BMI")
```

## under-five deaths
Not sure if it's a rate for 1000 population, WHO site not clear.
```{r}
summary(life_expectancy$UnderFiveDeaths)
#life_expectancy %>% ggplot(aes(x=life_expectancy$UnderFiveDeaths))+geom_histogram()

investigate_over1000("UnderFiveDeaths")
```


## Polio	
Description (from WHO): It's probably referring to "immunization coverage among one-year-olds (%)"

## Total expenditure
Description (from WHO): Total expenditure on health as a percentage of gross domestic product
200 N/A (out of almost 3,000 observations)

## Diphtheria
Description (from WHO): Diphtheria tetanus toxoid and pertussis (DTP3) immunization coverage among 1-year-olds (%)

Only small number of missing value, need to investigate more accuracy of the data

```{r}
investigate_missing_column_values("Diphtheria")
```

## HIV/AIDS
Description: there are 23 indicators related to HIV on the WHO web site, I'm not sure which one it is

## GDP
Countries' corresponding economic data was collected from United Nation website
448 N/A (out of almost 3,000 observations)
```{r GDP Data Cleanup}
# What rows are missing GDP?
missing_GDP_indices <- which(is.na(life_expectancy[,'GDP']))
length(missing_GDP_indices)

# Are any specific year a key indicator of missing value?
life_expectancy[missing_GDP_indices,] %>% 
  group_by(Year) %>%
  summarise(missing_GDP = length(Year))
# 2000-2015 are missing are about even for missing data except 2013 has more

# What about country?
life_expectancy[missing_GDP_indices,] %>% 
  group_by(Country) %>%
  summarise(missing_GDP = length(Country))

# Fill missing GDP data from secondary source

```

## Population
700 N/A (out of almost 3,000 observations)
Min is probably wrong (population of 34?) -- Maldives 2003
```{r}
investigate_missing_column_values("Population")
summary(life_expectancy$Population)

#investigate min
min(life_expectancy[,18], na.rm=T)
which.min(life_expectancy[,18])
print(life_expectancy[1615,])
```


## thinness  1-19 years
Description (from WHO): this could be Prevalence of thinness among children and adolescents, BMI < -2 standard deviations below the median (crude estimate) (%)
```{r}
investigate_missing_column_values("Thinness_1_19_years")
```


## thinness 5-9 years
Description: this could be a subset of the category above
```{r}
investigate_missing_column_values("Thinness_5_9_years")
```


## Income composition of resources	
United Nations Development Programme's [Human Development Index](http://hdr.undp.org/en/content/human-development-index-hdi) in terms of income composition of resources (index ranging from 0 to 1)
> The Human Development Index is a statistic composite index of life expectancy, education, and per capita income indicators, which are used to rank countries into four tiers of human development.
> `r tufte::quote_footer('--- Wikipedia')`

```{r}
# What rows are missing HDI?
missing_HDI_indices <- which(is.na(life_expectancy[,'IncomeCompositionOfResources']))
length(missing_HDI_indices)

# Are any specific year a key indicator of missing value?
life_expectancy[missing_HDI_indices,] %>% 
  group_by(Year) %>%
  summarise(missing_HDI = length(Year))
# 2000-2015 are missing are about even for missing data except 2013 has more

# What about country?
life_expectancy[missing_HDI_indices,] %>% 
  group_by(Country) %>%
  summarise(missing_HDI= length(Country))

# Year and Country Missing Entries
life_expectancy[missing_HDI_indices,c('Country','Year')]

# Import Modified CSV from UNDP as API is no longer active ()
## Original and modified are located in data, modified removes excess rows and .. values
UNDP_HDI_Bulk_Dataset <- read.csv("data/Modified_UNDP_HDI.csv",
                                  header=T,
                                  stringsAsFactors = T)
colnames(UNDP_HDI_Bulk_Dataset) <- sub("X", "", colnames(UNDP_HDI_Bulk_Dataset))
UNDP_HDI_Bulk_Dataset <- UNDP_HDI_Bulk_Dataset %>% select(-("2016":"2019") & -("1990":"1999"))

```

## Schooling
Definition: Average number of completed years of education of a country's population aged 25 years and older, excluding years spent repeating individual grades.

10 countries are missing all the values, we may have to fill some of them manually

```{r}
investigate_missing_column_values("Schooling")
```